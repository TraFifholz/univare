<ol class="items-list inventory-list">
  {{#each data.stages as |stage id|}}
  {{#if (eq stage.type "heritage")}}
    <li class="item flexrow" data-item-id="{{stage.id}}", style="background-color: lightgoldenrodyellow;">
      <div class="item-name">
        <label><b>{{stage.name}}</b></label>
      </div>
      <div class="item-controls">
        <a class="item-control item-create" data-action-key="{{id}}" title="Create item" data-type="feat"><i class="fas fa-plus"></i>新增</a>
      </div>
    </li>
    {{#each stage.feats as |feat key|}}
      <li class="item flexrow" data-item-id="{{feat._id}}">
        <div class="item-name rollable flexrow">
          <div class="item-image" style="background-image: url('{{feat.img}}')"></div>
          <h4>{{feat.name}}</h4>
        </div>
        
        <div><label><b>类型：</b></label><span>
          {{#if (eq feat.data.featType "feat")}}职业专长{{/if}}
          {{#if (eq feat.data.featType "talent")}}天赋{{/if}}
          {{#if (eq feat.data.featType "rPower")}}族裔专长{{/if}}
          {{#if (eq feat.data.featType "race")}}种族{{/if}}
          {{#if (eq feat.data.featType "heritage")}}遗传{{/if}}
          {{#if (eq feat.data.featType "origin")}}起源{{/if}}
        </span></div>
        <div class="item-controls">
            <a class="item-control item-edit" title="编辑"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="删除"><i class="fas fa-trash"></i></a>
        </div>
      </li>
    {{/each}}
  {{/if}}
  {{/each}}

  {{#each data.stages as |stage id|}}
  {{#if (eq stage.type "origin")}}
    <li class="item flexrow" data-item-id="{{stage.id}}", style="background-color: lightgoldenrodyellow;">
      <div class="item-name">
        <label><b>{{stage.name}}</b></label>
      </div>
      <div class="item-controls">
        <a class="item-control item-create" data-action-key="{{id}}" title="Create item" data-type="feat"><i class="fas fa-plus"></i>新增</a>
      </div>
    </li>
    {{#each stage.feats as |feat key|}}
      <li class="item flexrow" data-item-id="{{feat._id}}">
        <div class="item-name rollable flexrow">
          <div class="item-image" style="background-image: url('{{feat.img}}')"></div>
          <h4>{{feat.name}}</h4>
        </div>
        <div><label><b>类型：</b></label><span>
          {{#if (eq feat.data.featType "feat")}}职业专长{{/if}}
          {{#if (eq feat.data.featType "talent")}}天赋{{/if}}
          {{#if (eq feat.data.featType "rPower")}}族裔专长{{/if}}
          {{#if (eq feat.data.featType "race")}}种族{{/if}}
          {{#if (eq feat.data.featType "heritage")}}遗传{{/if}}
          {{#if (eq feat.data.featType "origin")}}起源{{/if}}
        </span></div>
        <div class="item-controls">
            <a class="item-control item-edit" title="编辑"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="删除"><i class="fas fa-trash"></i></a>
        </div>
      </li>
    {{/each}}
  {{/if}}
  {{/each}}

  {{#each stage.feats as |feat key|}}
    <li class="item rollable flexrow" data-item-id="{{feat._id}}">
      <div class="item-name flexrow">
        <div class="item-image" style="background-image: url('{{feat.img}}')"></div>
        <h4>{{feat.name}}</h4>
      </div>
      <div><label><b>类型：</b></label><span>
        {{#if (eq feat.data.featType "feat")}}职业专长{{/if}}
        {{#if (eq feat.data.featType "talent")}}天赋{{/if}}
        {{#if (eq feat.data.featType "rPower")}}族裔专长{{/if}}
        {{#if (eq feat.data.featType "race")}}种族{{/if}}
        {{#if (eq feat.data.featType "heritage")}}遗传{{/if}}
        {{#if (eq feat.data.featType "origin")}}起源{{/if}}
      </span></div>
      <div class="item-controls">
          <a class="item-control item-edit" title="编辑"><i class="fas fa-edit"></i></a>
          <a class="item-control item-delete" title="删除"><i class="fas fa-trash"></i></a>
      </div>
    </li>
  {{/each}}
  
  <li class="item flexrow item-header">
    <div class="item-name"><b>人物阶级</b></div>
    <div class="item-controls">
      <a class="stage-create-cha"><i class="fa fa-plus">阶级</i></a>
    </div>
  </li>
  
  {{#each data.stages as |stage id|}}
  {{#if (eq stage.type "chara")}}
    <li class="item flexrow" data-item-id="{{stage.id}}", style="background-color: lightblue;">
      <div>
        <a class="stage-delete" data-action-key="{{id}}"><i class="fas fa-trash"></i></a>
        <label>{{stage.name}}</label>
      </div>
      <div>
        <span>生命骰：</span>
        <input type="text" name="data.stages.{{id}}.hit_dice" value="{{stage.hit_dice}}" style="width:50px;"/>
      </div>
      <div class="item-controls">
        <a class="item-control item-create" data-action-key="{{id}}" title="Create item" data-type="feat"><i class="fas fa-plus"></i>新增</a>
      </div>
    </li>
    {{#each stage.feats as |feat key|}}
      <li class="item flexrow" data-item-id="{{feat._id}}">
        <div class="item-name rollable flexrow">
          <div class="item-image" style="background-image: url('{{feat.img}}')"></div>
          <h4>{{feat.name}}</h4>
        </div>
        <div><label><b>类型：</b></label><span>
          {{#if (eq feat.data.featType "feat")}}职业专长{{/if}}
          {{#if (eq feat.data.featType "talent")}}天赋{{/if}}
          {{#if (eq feat.data.featType "rPower")}}族裔专长{{/if}}
          {{#if (eq feat.data.featType "race")}}种族{{/if}}
          {{#if (eq feat.data.featType "heritage")}}遗传{{/if}}
          {{#if (eq feat.data.featType "origin")}}起源{{/if}}
        </span></div>
        <div class="item-controls">
            <a class="item-control item-edit" title="编辑"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="删除"><i class="fas fa-trash"></i></a>
        </div>
      </li>
    {{/each}}
  {{/if}}
  {{/each}}
  
  <li class="item flexrow item-header">
    <div class="item-name"><b>训练阶级</b></div>
    <div class="item-controls">
      <a class="stage-create-cla"><i class="fa fa-plus">阶级</i></a>
    </div>
  </li>
  
  {{#each data.stages as |stage id|}}
  {{#if (eq stage.type "train")}}
    <li class="item flexrow" data-item-id="{{stage.id}}" style="background-color:lightcoral;">
      <section>
        <a class="stage-delete" data-action-key="{{id}}"><i class="fas fa-trash"></i></a>
        <input type="text" name="data.stages.{{id}}.name" value="{{stage.name}}" style="width:100px;"/>
      </section>
      <div>
        <span>生命骰：</span>
        <input type="text" name="data.stages.{{id}}.hit_dice" value="{{stage.hit_dice}}" style="width:50px;"/>
      </div>
      <div class="item-controls">
        <a class="item-control item-create" data-action-key="{{id}}" title="Create item" data-type="feat"><i class="fas fa-plus"></i>新增</a>
      </div>
    </li>
    {{#each stage.feats as |feat key|}}
      <li class="item flexrow" data-item-id="{{feat._id}}">
        <div class="item-name rollable flexrow">
          <div class="item-image" style="background-image: url('{{feat.img}}')"></div>
          <h4>{{feat.name}}</h4>
        </div>
        <div>
          <label><b>类型：</b></label>
          <span>
            {{#if (eq feat.data.featType "feat")}}职业专长{{/if}}
            {{#if (eq feat.data.featType "talent")}}天赋{{/if}}
            {{#if (eq feat.data.featType "rPower")}}族裔专长{{/if}}
            {{#if (eq feat.data.featType "race")}}种族{{/if}}
            {{#if (eq feat.data.featType "heritage")}}遗传{{/if}}
            {{#if (eq feat.data.featType "origin")}}起源{{/if}}
          </span>
        </div>
        <div class="item-controls">
            <a class="item-control item-edit" title="编辑"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="删除"><i class="fas fa-trash"></i></a>
        </div>
      </li>
    {{/each}}
  {{/if}}
  {{/each}}  
  <li class="item flexrow" data-item-id="{{stage.id}}", style="background-color: lightgoldenrodyellow;">
    <div class="item-name">
      <label><b>未归类</b></label>
    </div>
    <div class="item-controls">
      <a class="item-control item-create" data-action-key="{{id}}" title="Create item" data-type="feat"><i class="fas fa-plus"></i>新增</a>
    </div>
  </li>
  {{#each noneStageFeats as |feat key|}}
    <li class="item flexrow" data-item-id="{{feat._id}}">
      <div class="item-name rollable flexrow">
        <div class="item-image" style="background-image: url('{{feat.img}}')"></div>
        <h4>{{feat.name}}</h4>
      </div>
      
      <div><label><b>类型：</b></label><span>
        {{#if (eq feat.data.featType "feat")}}职业专长{{/if}}
        {{#if (eq feat.data.featType "talent")}}天赋{{/if}}
        {{#if (eq feat.data.featType "rPower")}}族裔专长{{/if}}
        {{#if (eq feat.data.featType "race")}}种族{{/if}}
        {{#if (eq feat.data.featType "heritage")}}遗传{{/if}}
        {{#if (eq feat.data.featType "origin")}}起源{{/if}}
      </span></div>
      <div class="item-controls">
          <a class="item-control item-edit" title="编辑"><i class="fas fa-edit"></i></a>
          <a class="item-control item-delete" title="删除"><i class="fas fa-trash"></i></a>
      </div>
    </li>
  {{/each}} 
</ol>